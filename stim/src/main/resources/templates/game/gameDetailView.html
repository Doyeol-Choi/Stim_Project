<!DOCTYPE HTML>
<html lang="ko"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
	<meta charset="UTF-8" />
	<title>Stim Pack 게임 상세 페이지</title>
	<link rel="shortcut icon" th:href="@{/image/favicon.ico}">
	<meta name="viewport" content="width=device-width, maximum-scale=1.0, minimum-scale=1, user-scalable=yes,initial-scale=1.0" />
	<link rel="stylesheet" type="text/css" th:href="@{/css/style.css}">
	<link rel="stylesheet" type="text/css" th:href="@{/css/game/gameDetailView.css?after}">
	
	<script src="http://code.jquery.com/jquery-3.6.0.min.js"></script>
	<script type="text/javascript" th:src="@{/js/game/gameview.js}"></script>
</head>
<body>
    <!-- header fragment 사용 -->
    <th:block th:replace="fragments/header/header :: headerFragment"></th:block>
    <div id="container">
    	<div id="contents">
	    	<h1 th:inline="text">[[${gameInfo.game_name}]]</h1>
	    	<div id="gameImg" class="gameInformation">
	    		<div style="width: 1020px; height: 500px; margin-left: 20px; background-color: black; padding-left: 45px;">

		    		<img alt="gameImg" th:src="@{/image/game/} + ${gameInfo.game_picture}">
	    		</div>
	    		<div id="aboutGame" class="gameInformation">
	    			<section id="gameSection">
    					<article id="gameContext" th:inline="text" >
	    					[[${gameInfo.game_context}]]
	    				</article>
					</section>
						<div sec:authorize="isAuthenticated()">
							<form id="reply_form" th:action="@{/gamereply}" method="post">
								<input type="hidden" id="user_code" name="user_code" th:value="${#authentication.principal.user_code}">
								<input type="hidden" id="game_code" name="user_id" th:value="${gameInfo.game_code}"> 
								<input type="hidden" id="" name="writer_code" th:value="${#authentication.principal.user_code}"> <!-- 로그인 시 value가 로그인 한 사람 값이 되야함 -->
								<textarea id="grade_context" name="grade_context" rows="5" cols="20" placeholder="댓글과 평점을 남겨주쇼" ></textarea>
								<input type="radio" id="grade_rate" name="grade_rate" value="g">good
								<input type="radio" id="grade_rate" name="grade_rate" value="b">bad
								<input id="reply_submit" name="reply_InsertBtn" type="button" value="댓글 남기기" th:onclick="inputReply()">
							</form>
		    			</div>
		    		<div id="reply_lists">
						<div class="reply_list" th:each="reply : ${reply}" th:id="|mentListBox${reply.grade_code}|">
							<div class="reply_image">
								<a> <img alt="프로필 사진" th:src="@{/image/profile/} + ${reply.user_picture}"> </a>
							</div>
							<div class="reply_content">
								<div class="user_nickname" th:text="${reply.user_nickname}"></div> 
								<span class="grade_regdate" th:text="${#dates.format(reply.grade_regdate,'yyyy년 MM월 dd일 HH시 mm 분')}"></span>
								<div class="grade_context" th:text="${reply.grade_context}"></div>
								<button sec:authorize="isAuthenticated()" class="reply_deletebtn" 
								th:if="${reply.user_code == #authentication.principal.user_code}" th:onclick="deleteReply(${reply.grade_code})">삭제</button> 
							</div>
						</div>
					</div>
					</div>
    			</div>
	    	</div>
	    	<div id="gameInfo" class="gameInformation">
	    		<div id="barBackground">
		    		<div id="barText">
			    		<ul>
			    			<li id="miniImg">
   				    		<img alt="gameImg" th:src="@{/image/game/} + ${gameInfo.game_picture}">
		    				</li>
			    			<li class="liText" th:inline="text">
			    				개발사: <span>[[${gameInfo.game_developer}]]</span>
			    			</li>
			    			<li class="liText" th:inline="text">
			    				배급사: <span>[[${gameInfo.game_distribution}]]</span>
			    			</li>
			    			<li class="liText">
			    				출시일: <span>[[${#dates.format(gameInfo.game_releaseDate, 'yy. MM. dd')}]]</span>
			    			</li>
			    			<li class="liText" th:inline="text">
			    				태  그: <span>[[${gameInfo.genre_1}]], [[${gameInfo.genre_2}]], [[${gameInfo.genre_3}]]</span>
			    			</li>
			    			<li th:if="${gameInfo.game_finalPrice}==${gameInfo.game_price}" class="liText" th:inline="text">
			    				가  격: <span>￦[[${#numbers.formatInteger(gameInfo.game_price, 0, 'COMMA')}]]</span>
		    				</li>
		    				<li th:if="${gameInfo.game_finalPrice}!=${gameInfo.game_price}" class="liText" th:inline="text">
			    				가  격: <span>￦[[${#numbers.formatInteger(gameInfo.game_finalPrice, 0, 'COMMA')}]]</span>
			    				<span style="background-color:#00AEEF; font-size: 8px; color:white; padding:1px;">[[${#numbers.formatInteger(gameInfo.game_discount, 0, 'COMMA')}]]%</span>
		    				</li>
		    				
			    		</ul>
			    		<div sec:authorize="isAnonymous()">
				    		<div class="wishCart" id="payNow">
			    				<button th:onclick="|location.href='@{/loginForm}'|">
			    					바로 구매하기
			    				</button>
				    		</div>
				    		<div class="wishCart">
				    			<button th:onclick="|location.href='@{/loginForm}'|">
				    				찜하기
				    			</button>			    		
				    		</div>
				    		<div class="wishCart">
			    				<button th:onclick="|location.href='@{/loginForm}'|">
			    					장바구니 담기
			    				</button>
				    		</div>
			    		</div>
			    		<div sec:authorize="isAuthenticated()">
			    			<div th:if="${not #lists.contains(game_code_my, gameInfo.game_code)}">
					    		<div class="wishCart" id="payNow">
				    				<button th:onclick="|paybtn(${#authentication.principal.user_code},${gameInfo.game_code},${gameInfo.game_finalPrice})|">
				    					바로 구매하기
				    				</button>
					    		</div>
					    		<div class="wishCart">
					    			<button th:id="|bwish${gameInfo.game_code}|" th:if="${not #lists.contains(game_code_wish, gameInfo.game_code)}" th:onclick="|insertwish(${#authentication.principal.user_code},${gameInfo.game_code})|">
					    				찜하기
					    			</button>
					    			<button th:id="|awish${gameInfo.game_code}|" th:onclick="|location.href='@{/wish/{user_code}(user_code=${#authentication.principal.user_code})}'|" style="display: none;">
					    				찜목록으로 이동
					    			</button>
					    			<button th:if="${#lists.contains(game_code_wish, gameInfo.game_code)}" th:onclick="|location.href='@{/wish/{user_code}(user_code=${#authentication.principal.user_code})}'|">
					    				찜목록으로 이동
					    			</button>		    		
					    		</div>
					    		<div class="wishCart">
				    				<button th:id="|bcart${gameInfo.game_code}|" th:if="${not #lists.contains(game_code_cart, gameInfo.game_code)}" th:onclick="|insertcart(${#authentication.principal.user_code},${gameInfo.game_code})|">
				    					장바구니 담기
				    				</button>
				    				<button th:id="|acart${gameInfo.game_code}|" th:onclick="|location.href='@{/cart/{user_code}(user_code=${#authentication.principal.user_code})}'|" style="display: none;">
										장바구니 이동됨
									</button>
									<button th:if="${#lists.contains(game_code_cart, gameInfo.game_code)}"  th:onclick="|location.href='@{/cart/{user_code}(user_code=${#authentication.principal.user_code})}'|">
										장바구니 이동됨
									</button>
					    		</div>
				    		</div>
				    		<div th:if="${#lists.contains(game_code_my, gameInfo.game_code)}" class="wishCart">
				    			<button th:onclick="|location.href='@{/profile/{user_code}(user_code=${#authentication.principal.user_code})}'|">
				    				보유중인 게임
				    			</button>
				    		</div>
			    		</div>
			    		
		    		</div>
	    		</div>
	    	</div>	   	
    	</div>
    	
    </div>
    <!-- footer fragment 사용 -->
    <th:block th:replace="fragments/footer/footer :: footerFragment"></th:block>
    
    
    
</body>
</html>